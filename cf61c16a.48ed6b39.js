(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{54:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(59),s=a(61),c=a(72),i=a(3),m=a(55),u=a(56),p=a.n(u),h=a(73),d=a(66),y=a(62),l=a(84),C=a(74),g=a(76),f=a(85),w=a(77),v=a(70),b=a(63),E=a(82),A=function(e){function t(t){var a;a=e.call(this,t)||this;var n=t.match.params.id,r=a.getCountryData(t.match.params.id);a.platformRepo=new b.a(y),a.gatewayRepo=new v.a(y);var o=a.getGateways(n),s=a.getRecommended(o);return a.state={country:r,gateways:o,compare:s},a.onChangeCountry=a.onChangeCountry.bind(Object(c.a)(a)),a.onChangeGateway=a.onChangeGateway.bind(Object(c.a)(a)),a.addToCompare=a.addToCompare.bind(Object(c.a)(a)),a.clearAndAddToCompare=a.clearAndAddToCompare.bind(Object(c.a)(a)),a.removeFromCompare=a.removeFromCompare.bind(Object(c.a)(a)),a}Object(i.a)(t,e);var a=t.prototype;return a.getCountryData=function(e){return p.a.find(d,{code:p.a.upperCase(e)})},a.componentDidMount=function(){var e=this;this.state.country||this.getCountryByIp().then((function(t){t&&e.props.history.push("/country/"+p.a.lowerCase(t))}))},a.componentDidUpdate=function(e,t,a){var n=this,r=this.props.match.params.id;if(p.a.get(e,"match.params.id")!==r){var o=this.getCountryData(r);o||this.getCountryByIp().then((function(e){e&&n.props.history.push("/country/"+p.a.lowerCase(e))}));var s=this.getGateways(r),c=this.getRecommended(s);this.setState({gateways:s,compare:c,country:o})}},a.getCountryByIp=function(){var e=new E.a(h.a.ip_stack_api_key);return E.a.getIpAddress().then((function(t){return e.countryCode(t)}))},a.onChangeCountry=function(e){this.props.match.params.id!==e.value&&this.props.history.push("/country/"+p.a.lowerCase(e.value))},a.getGateways=function(e){return void 0===e&&(e=null),this.gatewayRepo.query().whereIncludes("countries",e?p.a.upperCase(e):null).get()},a.getGatewaysCountries=function(){var e=new Set,t=this.getGateways();return t&&t.forEach((function(t){(t.countries||[]).forEach((function(t){e.add(t)}))})),e},a.getOrdered=function(e){return p.a.orderBy(e,["recommended","name"],["asc","asc"])},a.addToCompare=function(e){var t=[].concat(this.state.compare);t.push(e),this.setState({compare:t})},a.clearAndAddToCompare=function(e){var t=[];t.push(e),this.setState({compare:t})},a.removeFromCompare=function(e){var t=[].concat(this.state.compare);t=p.a.filter(t,(function(t){return t.id!==e.id})),this.setState({compare:t})},a.onChangeGateway=function(e){var t=p.a.find(this.state.gateways,{id:e.value});this.clearAndAddToCompare(t)},a.getECommerces=function(){return this.platformRepo.query().where("type","=","ECOMMERCE").get()},a.getRecommended=function(e){return p.a.filter(e,{recommended:!0})},a.render=function(){return this.state.country?r.a.createElement(o.a,{title:(this.state.country||{name:"Shuttle"}).name+" | What payment gateway should I use?"},r.a.createElement("div",{className:"container"})," ",r.a.createElement("div",{className:Object(m.a)("container","my-5")},r.a.createElement(w.a,{img:this.state.country.flag_base64,name:this.state.country.name,className:"bordered"}),r.a.createElement(C.a,{countries:this.getGatewaysCountries(),className:"mb-5",onChange:this.onChangeCountry,value:p.a.upperCase(this.state.country.code)}),r.a.createElement("hr",null),r.a.createElement(f.a,{title:"The following payment processors support "+this.state.country.name,gateways:this.getOrdered(this.state.gateways),selected:this.state.compare,onShow:this.clearAndAddToCompare,onAddToCompare:this.addToCompare,onRemoveFromCompare:this.removeFromCompare}),r.a.createElement(g.a,{gateways:this.state.gateways,recommendedFirst:!0,value:p.a.get(this,"state.compare[0]"),onChange:this.onChangeGateway,className:"mb-5"}),r.a.createElement(l.a,{platform:this.platform,gateways:this.state.compare,country:this.state.country.code,ecommerces:this.getECommerces(),className:"mx-auto"}))):null},t}(r.a.Component);t.default=function(){var e=Object(s.e)();return r.a.createElement(s.c,null,r.a.createElement(s.b,{path:e.path+"/:id?",component:A}))}}}]);